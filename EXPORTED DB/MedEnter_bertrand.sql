--------------------------------------------------------
--  File created - Tuesday-December-09-2025   
--------------------------------------------------------
DROP TABLE "BERTRAND"."ALERTS_LOG";
DROP TABLE "BERTRAND"."BATCH_INVENTORY";
DROP TABLE "BERTRAND"."MEDICINES";
DROP TABLE "BERTRAND"."MEDICINES";
DROP TABLE "BERTRAND"."ALERTS_LOG";
DROP TABLE "BERTRAND"."BATCH_INVENTORY";
--------------------------------------------------------
--  DDL for Table ALERTS_LOG
--------------------------------------------------------

  CREATE TABLE "BERTRAND"."ALERTS_LOG" 
   (	"ALERT_ID" NUMBER, 
	"MED_ID" NUMBER, 
	"ALERT_TYPE" VARCHAR2(50 BYTE), 
	"MESSAGE" VARCHAR2(500 BYTE), 
	"ALERT_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table BATCH_INVENTORY
--------------------------------------------------------

  CREATE TABLE "BERTRAND"."BATCH_INVENTORY" 
   (	"BATCH_ID" NUMBER, 
	"MED_ID" NUMBER, 
	"BATCH_NUMBER" VARCHAR2(50 BYTE), 
	"QUANTITY_IN_STOCK" NUMBER, 
	"EXPIRY_DATE" DATE, 
	"ENTRY_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table MEDICINES
--------------------------------------------------------

  CREATE TABLE "BERTRAND"."MEDICINES" 
   (	"MED_ID" NUMBER, 
	"MED_NAME" VARCHAR2(100 BYTE), 
	"DOSAGE" VARCHAR2(50 BYTE), 
	"REORDER_LEVEL" NUMBER DEFAULT 100, 
	"TOTAL_QUANTITY" NUMBER DEFAULT 0, 
	"CREATED_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table MEDICINES
--------------------------------------------------------

  CREATE TABLE "BERTRAND"."MEDICINES" 
   (	"MED_ID" NUMBER, 
	"MED_NAME" VARCHAR2(100 BYTE), 
	"DOSAGE" VARCHAR2(50 BYTE), 
	"REORDER_LEVEL" NUMBER DEFAULT 100, 
	"TOTAL_QUANTITY" NUMBER DEFAULT 0, 
	"CREATED_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table ALERTS_LOG
--------------------------------------------------------

  CREATE TABLE "BERTRAND"."ALERTS_LOG" 
   (	"ALERT_ID" NUMBER, 
	"MED_ID" NUMBER, 
	"ALERT_TYPE" VARCHAR2(50 BYTE), 
	"MESSAGE" VARCHAR2(500 BYTE), 
	"ALERT_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table BATCH_INVENTORY
--------------------------------------------------------

  CREATE TABLE "BERTRAND"."BATCH_INVENTORY" 
   (	"BATCH_ID" NUMBER, 
	"MED_ID" NUMBER, 
	"BATCH_NUMBER" VARCHAR2(50 BYTE), 
	"QUANTITY_IN_STOCK" NUMBER, 
	"EXPIRY_DATE" DATE, 
	"ENTRY_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
REM INSERTING into BERTRAND.ALERTS_LOG
SET DEFINE OFF;
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (1,1,'BATCH_ADDED','Successfully added batch BATCH001 for Paracetamol. Quantity: 500, New total: 500',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (2,2,'BATCH_ADDED','Successfully added batch BATCH002 for Amoxicillin. Quantity: 300, New total: 300',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (3,3,'EXPIRED_BATCH_REJECTED','Batch BATCH_EXPIRED for Ibuprofen rejected: Already expired on 24-NOV-2025',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (4,3,'EXPIRED_BATCH_REJECTED','Batch BATCH_EXPIRED for Ibuprofen rejected: Already expired on 24-NOV-2025',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (5,3,'EXPIRED_BATCH_REJECTED','Batch BATCH_EXPIRED for Ibuprofen rejected: Already expired on 24-NOV-2025',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (6,2,'BATCH_ADDED','Successfully added batch BATCH_VALID_001 for Amoxicillin. Quantity: 500, New total: 800',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (7,3,'EXPIRED_BATCH_REJECTED','Batch BATCH_EXPIRED for Ibuprofen rejected: Already expired on 24-NOV-2025',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (8,4,'NEAR_EXPIRY_REJECTED','Batch BATCH_NEAR_EXPIRY for Metformin rejected: Expires in 30 days (less than 60 days)',to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.ALERTS_LOG (ALERT_ID,MED_ID,ALERT_TYPE,MESSAGE,ALERT_DATE) values (9,1,'BATCH_ADDED','Successfully added batch PARA2025A for Paracetamol. Quantity: 500, New total: 1000',to_date('04-DEC-25','DD-MON-RR'));
REM INSERTING into BERTRAND.BATCH_INVENTORY
SET DEFINE OFF;
Insert into BERTRAND.BATCH_INVENTORY (BATCH_ID,MED_ID,BATCH_NUMBER,QUANTITY_IN_STOCK,EXPIRY_DATE,ENTRY_DATE) values (1,1,'BATCH001',500,to_date('04-DEC-26','DD-MON-RR'),to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.BATCH_INVENTORY (BATCH_ID,MED_ID,BATCH_NUMBER,QUANTITY_IN_STOCK,EXPIRY_DATE,ENTRY_DATE) values (2,2,'BATCH002',300,to_date('04-JUN-26','DD-MON-RR'),to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.BATCH_INVENTORY (BATCH_ID,MED_ID,BATCH_NUMBER,QUANTITY_IN_STOCK,EXPIRY_DATE,ENTRY_DATE) values (3,2,'BATCH_VALID_001',500,to_date('04-DEC-26','DD-MON-RR'),to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.BATCH_INVENTORY (BATCH_ID,MED_ID,BATCH_NUMBER,QUANTITY_IN_STOCK,EXPIRY_DATE,ENTRY_DATE) values (4,1,'PARA2025A',500,to_date('04-JUN-27','DD-MON-RR'),to_date('04-DEC-25','DD-MON-RR'));
REM INSERTING into BERTRAND.MEDICINES
SET DEFINE OFF;
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (1,'Paracetamol','500mg',200,1000,to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (2,'Amoxicillin','250mg',150,800,to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (3,'Ibuprofen','400mg',100,0,to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (4,'Metformin','850mg',120,0,to_date('04-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (21,'Aspirin','100mg',150,0,to_date('05-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (22,'Ciprofloxacin','500mg',100,0,to_date('05-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (23,'Omeprazole','20mg',120,0,to_date('05-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (24,'Atorvastatin','40mg',80,0,to_date('05-DEC-25','DD-MON-RR'));
Insert into BERTRAND.MEDICINES (MED_ID,MED_NAME,DOSAGE,REORDER_LEVEL,TOTAL_QUANTITY,CREATED_DATE) values (25,'Losartan','50mg',100,0,to_date('05-DEC-25','DD-MON-RR'));
--------------------------------------------------------
--  DDL for Index SYS_C008524
--------------------------------------------------------

  CREATE UNIQUE INDEX "BERTRAND"."SYS_C008524" ON "BERTRAND"."ALERTS_LOG" ("ALERT_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Index SYS_C008519
--------------------------------------------------------

  CREATE UNIQUE INDEX "BERTRAND"."SYS_C008519" ON "BERTRAND"."BATCH_INVENTORY" ("BATCH_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Index UK_BATCH_NUMBER
--------------------------------------------------------

  CREATE UNIQUE INDEX "BERTRAND"."UK_BATCH_NUMBER" ON "BERTRAND"."BATCH_INVENTORY" ("BATCH_NUMBER") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Index SYS_C008513
--------------------------------------------------------

  CREATE UNIQUE INDEX "BERTRAND"."SYS_C008513" ON "BERTRAND"."MEDICINES" ("MED_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Trigger TRG_CHECK_REORDER_LEVEL
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "BERTRAND"."TRG_CHECK_REORDER_LEVEL" 
AFTER UPDATE OF total_quantity ON MEDICINES
FOR EACH ROW
 WHEN (NEW.total_quantity <= NEW.reorder_level) BEGIN
    -- This trigger automatically fires when stock reaches reorder level
    -- Additional logging can be added here if needed
    DBMS_OUTPUT.PUT_LINE('WARNING: ' || :NEW.med_name || 
                        ' has reached reorder level. Current stock: ' || 
                        :NEW.total_quantity);
END;

/
ALTER TRIGGER "BERTRAND"."TRG_CHECK_REORDER_LEVEL" ENABLE;
--------------------------------------------------------
--  Constraints for Table ALERTS_LOG
--------------------------------------------------------

  ALTER TABLE "BERTRAND"."ALERTS_LOG" MODIFY ("ALERT_TYPE" NOT NULL ENABLE);
  ALTER TABLE "BERTRAND"."ALERTS_LOG" MODIFY ("MESSAGE" NOT NULL ENABLE);
  ALTER TABLE "BERTRAND"."ALERTS_LOG" ADD PRIMARY KEY ("ALERT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
--------------------------------------------------------
--  Constraints for Table BATCH_INVENTORY
--------------------------------------------------------

  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" MODIFY ("MED_ID" NOT NULL ENABLE);
  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" MODIFY ("BATCH_NUMBER" NOT NULL ENABLE);
  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" MODIFY ("QUANTITY_IN_STOCK" NOT NULL ENABLE);
  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" MODIFY ("EXPIRY_DATE" NOT NULL ENABLE);
  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" ADD CONSTRAINT "CHK_QUANTITY" CHECK (quantity_in_stock >= 0) ENABLE;
  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" ADD PRIMARY KEY ("BATCH_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" ADD CONSTRAINT "UK_BATCH_NUMBER" UNIQUE ("BATCH_NUMBER")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
--------------------------------------------------------
--  Constraints for Table MEDICINES
--------------------------------------------------------

  ALTER TABLE "BERTRAND"."MEDICINES" MODIFY ("MED_NAME" NOT NULL ENABLE);
  ALTER TABLE "BERTRAND"."MEDICINES" ADD CONSTRAINT "CHK_REORDER_LEVEL" CHECK (reorder_level >= 0) ENABLE;
  ALTER TABLE "BERTRAND"."MEDICINES" ADD CONSTRAINT "CHK_TOTAL_QUANTITY" CHECK (total_quantity >= 0) ENABLE;
  ALTER TABLE "BERTRAND"."MEDICINES" ADD PRIMARY KEY ("MED_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ALERTS_LOG
--------------------------------------------------------

  ALTER TABLE "BERTRAND"."ALERTS_LOG" ADD CONSTRAINT "FK_ALERT_MED" FOREIGN KEY ("MED_ID")
	  REFERENCES "BERTRAND"."MEDICINES" ("MED_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table BATCH_INVENTORY
--------------------------------------------------------

  ALTER TABLE "BERTRAND"."BATCH_INVENTORY" ADD CONSTRAINT "FK_BATCH_MED" FOREIGN KEY ("MED_ID")
	  REFERENCES "BERTRAND"."MEDICINES" ("MED_ID") ENABLE;
